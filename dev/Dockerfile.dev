FROM registry.tld/ruby-fips-dev-base-image

RUN DEBIAN_FRONTEND=noninteractive apt-get update -y && \
    DEBIAN_FRONTEND=noninteractive apt-get install -y \
    build-essential \
    postgresql-client \
    libpq-dev \
    unattended-upgrades \
    ldap-utils \
    vim \
    jq \
    tzdata \
    libfontconfig1 \
    libfontconfig1-dev

RUN apt-get install -y wget openssl-
RUN apt-get install -y curl openssl-
RUN apt-get install -y git openssl-
RUN rm -rf /var/lib/apt/lists/*

RUN mkdir ~/.gnupg
RUN echo "disable-ipv6" >> ~/.gnupg/dirmngr.conf

RUN mkdir -p /src/conjur-server

ADD .pryrc /root

WORKDIR /src/conjur-server

ADD Gemfile      .
ADD Gemfile.lock .

RUN bundle

RUN ln -sf /src/conjur-server/bin/conjurctl /usr/local/bin/

ENV PORT 3000
ENV TERM xterm

EXPOSE 3000